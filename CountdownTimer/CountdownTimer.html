<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="Content/bootstrap.css" rel="stylesheet" />
    <link href="Content/Site.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Raleway" />

    <script src="Scripts/jquery-3.5.1.js"></script>
    <script src="Scripts/popper.js"></script>
    <script src="Scripts/bootstrap.js"></script>

    <title>TeamTime</title>
</head>

<body>
    <nav class="navbar">
        <span class="navbar-brand"><strong>TeamTime</strong></span>
    </nav>
    <div class="container-fluid" id="main">
        <div class="row">
            <!-- timer div -->
            <div class="col-7" id="timer">
                <div>
                    <h2 class="text-center">Timer</h2>
                </div>
                <div class="body-content">
                    <!-- total timer: the total of all sub-tasks -->
                    <div class="row" id="totalTime" style="justify-content: center">
                        <h6>Total Time</h6>
                        <h4 class="form-text text-muted">H</h4>
                        <h3 id="totalTimeHrs">00</h3>
                        <h4 class="form-text text-muted">M</h4>
                        <h3 id="totalTimeMins">00</h3>
                        <h4 class="form-text text-muted">S</h4>
                        <h3 id="totalTimeSecs">00</h3>
                    </div>
                    <!-- Total time countdown-->
                    <div class="row" id="globalCountdown" style="justify-content: center">
                        <h6>Total Remaining</h6>
                        <h4 class="form-text text-muted">H</h4>
                        <h3 id="globalCountdownHrs">00</h3>
                        <h4 class="form-text text-muted">M</h4>
                        <h3 id="globalCountdownMins">00</h3>
                        <h4 class="form-text text-muted">S</h4>
                        <h3 id="globalCountdownSecs">00</h3>
                    </div>
                    <!-- Task Time countdown-->
                    <div class="row" id="taskCountdown" style="justify-content: center">
                        <h6>Task Time</h6>
                        <h4 class="form-text text-muted">H</h4>
                        <h3 id="taskCountdownHrs">00</h3>
                        <h4 class="form-text text-muted">M</h4>
                        <h3 id="taskCountdownMins">00</h3>
                        <h4 class="form-text text-muted">S</h4>
                        <h3 id="taskCountdownSecs">00</h3>
                    </div>
                    <!-- Timer Buttons -->
                    <div class="row" style="justify-content: center" id="timerButtons">
                        <button type="button" id="start">Start</button>
                        <button type="button" id="pause">Pause</button>
                        <button type="button" id="stop">Stop</button>
                        <button type="button" id="clear">Clear</button>
                    </div>
                </div>
                <!-- Task List -->
                <div class="row">
                    <ol id="timerTaskList" style="width: 100%">
                    </ol>
                </div>
            </div>
            <!-- Configure div -->
            <div class="col-3" id="settings">
                <div>
                    <h2 class="text-center">Configure</h2>
                </div>
                <div class="body-content">
                    <div class="form-group">
                        <div>
                            <small class="form-text text-muted"><strong>Enter a task name</strong></small>
                            <input type="text" class="form-control" id="addTask" />
                        </div>
                        <div>
                            <small class="form-text text-muted"><strong>Enter a task duration (minutes)</strong></small>
                            <input type="number" class="form-control" id="addTaskDuration" />
                        </div>
                        <div style="text-align: center">
                            <button id="task" style="margin-top: 15px">Add Task</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>

    //Global Variables
    var globalSeconds = 0;
    var globalSecondsCompleted = 0;
    var globalSecondsRemaining = 0;

    var taskSeconds = 0;
    var taskSecondsCompleted = 0;
    var taskSecondsRemaining = 0;

    var exportInfo = [];
    var backupArray = [];

    //Event Handlers
    $("#task").on('click', function () { addTask($("#addTask").val(), $("#addTaskDuration").val()); });

    //TASK FUNCTIONS

    /* Adds task input from text/number forms and adds <li> items accordingly.
     Increments the global time variables every time a new task is added, 
     and calls setTimerText() to increment the timer on the UI.
     This function should only be called inside the onclick function for 
     the add task button and from within parseCSV() */

    function addTask(task, minutes) {
        //Add <h3> Sub Task title if one doesn't already exist.
        if (!document.getElementById("currentTasks")) {
            $('<h3>').addClass('text-center').attr('id', 'currentTasks').text("Sub Tasks").appendTo("#timerTaskList");
        }

        globalSeconds += minutes * 60;
        globalSecondsRemaining += minutes * 60;

        //Update task time-tracking variables if this is the first task to be entered.
        if (document.getElementsByTagName('li').length === 0) {
            taskSeconds = minutes * 60;
            taskSecondsRemaining = taskSeconds;
        }

        //Add to export CSV array
        exportInfo.push([task, minutes]);
        backupArray.push([task, minutes]);

        //Append to 'timerTaskList'.
        $('<li>').addClass('list-group-item list-group-item-action')
            .attr('id', 'listItem')
            .text("Task: " + task + " " + minutes + " minutes").attr('draggable', 'true')
            .attr('minutes', minutes).attr('complete', 'false').attr('active', 'false')
            .appendTo("#timerTaskList");

        $("#addTask").val("");
        $("#addTaskDuration").val(0);

        setTimerText("#totalTime", globalSeconds);
        setTimerText("#globalCountdown", globalSecondsRemaining);

        //Instantiate the task countdown timer if this is the first task.
        if (document.getElementsByTagName('li').length === 1) {
            setTimerText("#taskCountdown", taskSecondsRemaining);
        }
    }

    /* Takes the id of the timer as an input, as well as the seconds remaining for that particular timer,
     and sets/updates the time displayed to the user.
     There should be no reason to call this function outside of addTask() */

    function setTimerText(id, secondsRemaining) {

        const hms = toHMS(secondsRemaining);
        let [hours, minutes, seconds] = hms;

        if (hours < 10) {
            hours = "0" + hours;
        }
        if (minutes < 10) {
            minutes = "0" + minutes;
        }
        if (seconds < 10) {
            seconds = "0" + seconds;
        }

        $(id + "Hrs").text(hours);
        $(id + "Mins").text(minutes);
        $(id + "Secs").text(seconds);
    }


    //UTILITY FUNCTIONS

    /* Accepts hours, minutes and seconds as an input , returns the time value in seconds) */
    function toSeconds(hours, minutes, seconds) {
        return (hours * 3600) + (minutes * 60) + seconds;
    }

    /* Accepts seconds as input and returns hours, minutes and seconds as an array where
     [0] is hours, [1] is minutes, and [2] is seconds. */
    function toHMS(totalSeconds) {
        const hours = Math.floor((totalSeconds / 3600));
        const minutes = Math.floor((totalSeconds / 60) % 60);
        const seconds = Math.floor(totalSeconds % 60);
        return [hours, minutes, seconds];
    }

</script>
</body>

</html>